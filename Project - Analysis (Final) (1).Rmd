---
title: "STA 130 - Project"
author: "Riena Asakawa, Alfizza Khalfani Kenaz"
output:
  pdf_document: default
date: "2024-03-22"
---

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(broom)

opts_chunk$set(warning = FALSE, message = FALSE)
```


#### Data Cleaning and Wrangling ####

## Data Load
```{r}
# Load Country Codes
country_codes <- 
  read.csv("country_codes.csv") %>%
  select(-X) %>%  # remove first column (index)
  rename(country_code_iso3 = 'ISO.alpha3.Code..M49.', region = 'Region.Name_en..M49.', country_name = 'Country.or.Area_en..M49.') %>%
  select(region, country_name, country_code_iso3, everything())


# Load Country Indicators
country_indicators <- 
  read_csv("country_indicators.csv") %>%
  select(-...1) %>%  # remove first column (index)
  rename(country_code_iso3 = 'iso3') %>%  # rename column to country_code_iso3
  select(country_code_iso3, everything())  # reorder the columns to put iso3 as column 1


# Load SDG Report
sdg_report <- 
  read.csv("sdr_fd5e4b5a.csv") %>%
  select(-X) %>% #Remove first column (index)
  rename(country_code_iso3 = 'Country.Code.ISO3') %>% # Rename country code column
  select(country_code_iso3, everything())

```


## Get Country Region from Country Codes
```{r}
country_region_name_code <- country_codes %>%
  select(country_code_iso3, country_name, region)
```


## Get Country Background and Context Data (Q1)
```{r}
# Rate of Change Function with Linear Regression Model
calculate_rate_of_change <- function(data) {
  rate_of_progress <- c()
  
  for (n in 1:nrow(data)) {
    score <- c()
    year <- c()
    row <- data %>% nth(n)
    for (i in 3:ncol(row)) {
      year_index <- nchar(colnames(data)[i]) - 3
      year <- append(year, substring(colnames(data)[i], year_index))
      score <- append(score, row[[i]])
    }
    data_clear <- tibble(year=year, score=score)
    data_regression_model <- lm(score ~ year, data=data_clear)
    #print(data_clear %>% ggplot(aes(x=year, y=score)) + geom_point() + geom_smooth(se=FALSE, method="lm"))
    
    rate_of_progress <- append(rate_of_progress, summary(data_regression_model)$coefficients[2])
  }
  # Return the rate of progress from regression model
  return(rate_of_progress)
  
}

## ASIAN COUNTRY INDICATORS
asia_indicator <- full_join(x=country_indicators, y=country_region_name_code, by='country_code_iso3') %>%
  select(region, country_name, country_code_iso3,  everything()) %>%
  filter(region == "Asia") %>%
  distinct()

## AFRICAN COUNTRY INDICATORS
africa_indicator <- full_join(x=country_indicators, y=country_region_name_code, by='country_code_iso3') %>%
  select(region, country_name, country_code_iso3,  everything()) %>%
  filter(region == "Africa") %>%
  distinct()

## FOR UNDP’s Human Development Report
# Change the Year Here
year <- 2010:2021


```
##### SDG1 #####
```{r}
### UNDP's Human Development Report ###
###### ASIA ######
# Gross National Income Per Capita
asia_indicator_sdg1_hdr_gnipc <- asia_indicator %>% select(country_name, country_code_iso3, num_range('hdr_gnipc_', year)) %>% drop_na()

asia_indicator_sdg1_hdr_gnipc <- asia_indicator_sdg1_hdr_gnipc %>%
  mutate(
    # Mean
    mean = rowMeans(asia_indicator_sdg1_hdr_gnipc %>% select(contains('hdr_gnipc'))), 
    
    # Rate of change
    rate_of_change = calculate_rate_of_change(asia_indicator_sdg1_hdr_gnipc %>% select(contains('hdr_gnipc'))),
  )

# Inequality in Income
asia_indicator_sdg1_hdr_ineq_inc <- asia_indicator %>% select(country_name, country_code_iso3, num_range('hdr_ineq_inc_', year)) %>% drop_na()

asia_indicator_sdg1_hdr_ineq_inc <- asia_indicator_sdg1_hdr_ineq_inc %>%
  mutate(
    # Mean
    mean = rowMeans(asia_indicator_sdg1_hdr_ineq_inc %>% select(contains('hdr_ineq_inc'))), 
    
    # Rate of change
    rate_of_change = calculate_rate_of_change(asia_indicator_sdg1_hdr_ineq_inc %>% select(contains('hdr_ineq_inc'))),
  )

### World Bank's World Development Indicators ###
asia_indicator_sdg1_wbi_income_group <- asia_indicator %>% select(country_name, country_code_iso3, 'wbi_income_group') %>% drop_na()

### Fund for Peace’s Fragile States Index ###
# Economy Ratings
asia_indicator_sdg1_fsi_economy <- asia_indicator %>% select(country_name, country_code_iso3, 'fsi_e1:_economy') %>% drop_na()
# Economic Inequality Ratings
asia_indicator_sdg1_fsi_economic_inequality <- asia_indicator %>% select(country_name, country_code_iso3, 'fsi_e2:_economic_inequality') %>% drop_na()

######AFRICA######
# Gross National Income Per Capita
africa_indicator_sdg1_hdr_gnipc <- africa_indicator %>% select(country_name, country_code_iso3, num_range('hdr_gnipc_', year)) %>% drop_na()

africa_indicator_sdg1_hdr_gnipc <- africa_indicator_sdg1_hdr_gnipc %>%
  mutate(
    # Mean
    mean = rowMeans(africa_indicator_sdg1_hdr_gnipc %>% select(contains('hdr_gnipc'))), 
    
    # Rate of change
    rate_of_change = calculate_rate_of_change(africa_indicator_sdg1_hdr_gnipc %>% select(contains('hdr_gnipc'))),
  )

# Inequality in Income
africa_indicator_sdg1_hdr_ineq_inc <- africa_indicator %>% select(country_name, country_code_iso3, num_range('hdr_ineq_inc_', year)) %>% drop_na()

africa_indicator_sdg1_hdr_ineq_inc <- africa_indicator_sdg1_hdr_ineq_inc %>%
  mutate(
    # Mean
    mean = rowMeans(africa_indicator_sdg1_hdr_ineq_inc %>% select(contains('hdr_ineq_inc'))), 
    
    # Rate of change
    rate_of_change = calculate_rate_of_change(africa_indicator_sdg1_hdr_ineq_inc %>% select(contains('hdr_ineq_inc'))),
  )

### World Bank's World Development Indicators ###
africa_indicator_sdg1_wbi_income_group <- africa_indicator %>% select(country_name, country_code_iso3, 'wbi_income_group') %>% drop_na()

### Fund for Peace’s Fragile States Index ###
# Economy Ratings
africa_indicator_sdg1_fsi_economy <- africa_indicator %>% select(country_name, country_code_iso3, 'fsi_e1:_economy') %>% drop_na()
# Economic Inequality Ratings
africa_indicator_sdg1_fsi_economic_inequality <- africa_indicator %>% select(country_name, country_code_iso3, 'fsi_e2:_economic_inequality') %>% drop_na()

```
##### SDG3 #####
```{r}
##### ASIA #####
### UNICEF's 2023 World's Children Report ###
asia_indicator_sdg3_sowc_child_mortality <- asia_indicator %>% select(country_name, country_code_iso3, contains('sowc_child-mortality'))

asia_indicator_sdg3_sowc_maternal_newborn_health <- asia_indicator %>% select(country_name, country_code_iso3, contains('sowc_maternal-and-newborn-health'))

asia_indicator_sdg3_sowc_child_health <- asia_indicator %>% select(country_name, country_code_iso3, contains('sowc_child-health'))

asia_indicator_sdg3_sowc_childhood_development <- asia_indicator %>% select(country_name, country_code_iso3, contains('sowc_early-childhood-development'))

asia_indicator_sdg3_sowc_child_protection <- asia_indicator %>% select(country_name, country_code_iso3, contains('sowc_child-protection'))


### UNDP’s Human Development Report ###

# Life Expectancy
asia_indicator_sdg3_hdr_life_expectancy <- asia_indicator %>% select(country_name, country_code_iso3, num_range('hdr_le_', year)) %>% drop_na()

asia_indicator_sdg3_hdr_life_expectancy <- asia_indicator_sdg3_hdr_life_expectancy %>%
  mutate(
    # Mean
    mean = rowMeans(asia_indicator_sdg3_hdr_life_expectancy %>% select(contains('hdr_le'))), 
    
    # Rate of change
    rate_of_change = calculate_rate_of_change(asia_indicator_sdg3_hdr_life_expectancy %>% select(contains('hdr_le'))),
  )

asia_indicator_sdg3_hdr_life_expectancy_gender <- asia_indicator %>% select(country_name, country_code_iso3, num_range('hdr_le_m_', year), num_range('hdr_le_f_', year)) %>% drop_na()

asia_indicator_sdg3_hdr_life_expectancy_gender <- asia_indicator_sdg3_hdr_life_expectancy_gender %>%
  mutate(
    # Mean
    mean_m = rowMeans(asia_indicator_sdg3_hdr_life_expectancy_gender %>% select(contains('hdr_le_m'))), 
    mean_f = rowMeans(asia_indicator_sdg3_hdr_life_expectancy_gender %>% select(contains('hdr_le_f'))), 
    
    # Rate of change
    rate_of_change_m = calculate_rate_of_change(asia_indicator_sdg3_hdr_life_expectancy_gender %>% select(contains('hdr_le_m'))), 
    rate_of_change_f = calculate_rate_of_change(asia_indicator_sdg3_hdr_life_expectancy_gender %>% select(contains('hdr_le_f')))
  )

##### AFRICA #####
### UNICEF's 2023 World's Children Report ###
africa_indicator_sdg3_sowc_child_mortality <- africa_indicator %>% select(country_name, country_code_iso3, contains('sowc_child-mortality'))

africa_indicator_sdg3_sowc_maternal_newborn_health <- africa_indicator %>% select(country_name, country_code_iso3, contains('sowc_maternal-and-newborn-health'))

africa_indicator_sdg3_sowc_child_health <- africa_indicator %>% select(country_name, country_code_iso3, contains('sowc_child-health'))

africa_indicator_sdg3_sowc_childhood_development <- africa_indicator %>% select(country_name, country_code_iso3, contains('sowc_early-childhood-development'))

africa_indicator_sdg3_sowc_child_protection <- africa_indicator %>% select(country_name, country_code_iso3, contains('sowc_child-protection'))


### UNDP’s Human Development Report ###

# Life Expectancy
africa_indicator_sdg3_hdr_life_expectancy <- africa_indicator %>% select(country_name, country_code_iso3, num_range('hdr_le_', year)) %>% drop_na()

africa_indicator_sdg3_hdr_life_expectancy <- africa_indicator_sdg3_hdr_life_expectancy %>%
  mutate(
    # Mean
    mean = rowMeans(africa_indicator_sdg3_hdr_life_expectancy %>% select(contains('hdr_le'))), 
    
    # Rate of change
    rate_of_change = calculate_rate_of_change(africa_indicator_sdg3_hdr_life_expectancy %>% select(contains('hdr_le'))),
  )

africa_indicator_sdg3_hdr_life_expectancy_gender <- africa_indicator %>% select(country_name, country_code_iso3, num_range('hdr_le_m_', year), num_range('hdr_le_f_', year)) %>% drop_na()

africa_indicator_sdg3_hdr_life_expectancy_gender <- africa_indicator_sdg3_hdr_life_expectancy_gender %>%
  mutate(
    # Mean
    mean_m = rowMeans(africa_indicator_sdg3_hdr_life_expectancy_gender %>% select(contains('hdr_le_m'))), 
    mean_f = rowMeans(africa_indicator_sdg3_hdr_life_expectancy_gender %>% select(contains('hdr_le_f'))), 
    
    # Rate of change
    rate_of_change_m = calculate_rate_of_change(africa_indicator_sdg3_hdr_life_expectancy_gender %>% select(contains('hdr_le_m'))), 
    rate_of_change_f = calculate_rate_of_change(africa_indicator_sdg3_hdr_life_expectancy_gender %>% select(contains('hdr_le_f')))
  )

```
##### SDG 4 #####
```{r}
### UNICEF's 2023 World's Children Report ###
asia_indicator_sdg4_sowc_access_out_of_school_rate_2013_2022 <- asia_indicator %>%
  select(
    country_name, country_code_iso3,
    contains('sowc_education__equitable-access_out-of-school-rate-2013-2022')
  ) %>%
  
  rename(
    one_year_before_primary_entry_age_male = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_one-year-before-primary-entry-age_male`, 
    one_year_before_primary_entry_age_female = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_one-year-before-primary-entry-age_female`,
    primary_education_male = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_primary-education_male`,
    primary_education_female = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_primary-education_female`, 
    lower_secondary_education_male = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_lower-secondary-education_male`,
    lower_secondary_education_female = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_lower-secondary-education_female`, 
    upper_secondary_education_male = 
`sowc_education__equitable-access_out-of-school-rate-2013-2022-r_upper-secondary-education_male`,
    upper_secondary_education_female = 
`sowc_education__equitable-access_out-of-school-rate-2013-2022-r_upper-secondary-education_female`
    ) %>%
  drop_na()


africa_indicator_sdg4_sowc_access_out_of_school_rate_2013_2022 <- africa_indicator %>%
  select(
    country_name, country_code_iso3,
    contains('sowc_education__equitable-access_out-of-school-rate-2013-2022')
  ) %>%
  
  rename(
    one_year_before_primary_entry_age_male = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_one-year-before-primary-entry-age_male`, 
    one_year_before_primary_entry_age_female = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_one-year-before-primary-entry-age_female`,
    primary_education_male = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_primary-education_male`,
    primary_education_female = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_primary-education_female`, 
    lower_secondary_education_male = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_lower-secondary-education_male`,
    lower_secondary_education_female = `sowc_education__equitable-access_out-of-school-rate-2013-2022-r_lower-secondary-education_female`, 
    upper_secondary_education_male = 
`sowc_education__equitable-access_out-of-school-rate-2013-2022-r_upper-secondary-education_male`,
    upper_secondary_education_female = 
`sowc_education__equitable-access_out-of-school-rate-2013-2022-r_upper-secondary-education_female`
    ) %>%
  drop_na()
  # May replace drop NA to drop only specific rows with entries starting at a column


### UNDP’s Human Development Report ###
## Inequality in Education (hdr_ineq_edu)

# ASIA
asia_indicator_sdg4_hdr_ineq_edu <- asia_indicator %>% select(country_name, country_code_iso3, num_range('hdr_ineq_edu_', year)) %>% drop_na()

asia_indicator_sdg4_hdr_ineq_edu <- asia_indicator_sdg4_hdr_ineq_edu %>%
  mutate(
    mean = rowMeans(asia_indicator_sdg4_hdr_ineq_edu %>% select(contains('hdr_ineq_edu'))),
    rate_of_change = calculate_rate_of_change(asia_indicator_sdg4_hdr_ineq_edu))
   
# AFRICA
africa_indicator_sdg4_hdr_ineq_edu <- africa_indicator %>% select(country_name, country_code_iso3, contains('hdr_ineq_edu')) %>% drop_na()

africa_indicator_sdg4_hdr_ineq_edu <- africa_indicator_sdg4_hdr_ineq_edu %>%
  mutate(
    mean = rowMeans(africa_indicator_sdg4_hdr_ineq_edu %>% select(contains('hdr_ineq_edu'))),
    rate_of_change = calculate_rate_of_change(africa_indicator_sdg4_hdr_ineq_edu))


## Expected Years of Schooling (hdr_eys)
# ASIA
asia_indicator_sdg4_hdr_eys <- asia_indicator %>% select(country_name, country_code_iso3,  num_range('hdr_eys_', year)) %>% drop_na()

asia_indicator_sdg4_hdr_eys_gender <- asia_indicator %>% select(country_name, country_code_iso3,  num_range('hdr_eys_m_', year), num_range('hdr_eys_f_', year),) %>% drop_na()

# Parameters
asia_indicator_sdg4_hdr_eys <- asia_indicator_sdg4_hdr_eys %>%
  mutate(
    # Mean
    mean_m = rowMeans(asia_indicator_sdg4_hdr_eys %>% select(contains('hdr_eys'))), 
    
    # Rate of change
    rate_of_change = calculate_rate_of_change(asia_indicator_sdg4_hdr_eys %>% select(contains('hdr_eys'))),
  )

asia_indicator_sdg4_hdr_eys_gender <- asia_indicator_sdg4_hdr_eys_gender %>%
  mutate(
    # Mean
    mean_m = rowMeans(asia_indicator_sdg4_hdr_eys_gender %>% select(contains('hdr_eys_m'))), 
    mean_f = rowMeans(asia_indicator_sdg4_hdr_eys_gender %>% select(contains('hdr_eys_f'))), 
    
    # Rate of change
    rate_of_change_m = calculate_rate_of_change(asia_indicator_sdg4_hdr_eys_gender %>% select(contains('hdr_eys_m'))), 
    rate_of_change_f = calculate_rate_of_change(asia_indicator_sdg4_hdr_eys_gender %>% select(contains('hdr_eys_f')))
  )

# AFRICA
africa_indicator_sdg4_hdr_eys <- africa_indicator %>% select(country_name, country_code_iso3, num_range('hdr_eys_', year)) %>% drop_na()

africa_indicator_sdg4_hdr_eys_gender <- africa_indicator %>% select(country_name, country_code_iso3, num_range('hdr_eys_m_', year), num_range('hdr_eys_f_', year)) %>% drop_na()

# Parameters
africa_indicator_sdg4_hdr_eys <- africa_indicator_sdg4_hdr_eys %>%
  mutate(
    # Mean
    mean_m = rowMeans(africa_indicator_sdg4_hdr_eys %>% select(contains('hdr_eys'))), 
    
    # Rate of change
    rate_of_change = calculate_rate_of_change(africa_indicator_sdg4_hdr_eys %>% select(contains('hdr_eys'))), 
  )

africa_indicator_sdg4_hdr_eys_gender <- africa_indicator_sdg4_hdr_eys_gender %>%
  mutate(
    # Mean
    mean_m = rowMeans(africa_indicator_sdg4_hdr_eys_gender %>% select(contains('hdr_eys_m'))), 
    mean_f = rowMeans(africa_indicator_sdg4_hdr_eys_gender %>% select(contains('hdr_eys_f'))), 
    
    # Rate of change
    rate_of_change_m = calculate_rate_of_change(africa_indicator_sdg4_hdr_eys_gender %>% select(contains('hdr_eys_m'))), 
    rate_of_change_f = calculate_rate_of_change(africa_indicator_sdg4_hdr_eys_gender %>% select(contains('hdr_eys_f')))
  )

## Mean Years of Schooling (hdr_mys)
# ASIA
asia_indicator_sdg4_hdr_mys <- asia_indicator %>% select(country_name, country_code_iso3,  num_range('hdr_mys_', year)) %>% drop_na()

asia_indicator_sdg4_hdr_mys_gender <- asia_indicator %>% select(country_name, country_code_iso3,  num_range('hdr_mys_m_', year), num_range('hdr_mys_f_', year),) %>% drop_na()

# Parameters
asia_indicator_sdg4_hdr_mys <- asia_indicator_sdg4_hdr_mys %>%
  mutate(
    # Mean
    mean_m = rowMeans(asia_indicator_sdg4_hdr_mys %>% select(contains('hdr_mys'))), 
    
    # Rate of change
    rate_of_change = calculate_rate_of_change(asia_indicator_sdg4_hdr_mys %>% select(contains('hdr_mys'))),
  )

asia_indicator_sdg4_hdr_mys_gender <- asia_indicator_sdg4_hdr_mys_gender %>%
  mutate(
    # Mean
    mean_m = rowMeans(asia_indicator_sdg4_hdr_mys_gender %>% select(contains('hdr_mys_m'))), 
    mean_f = rowMeans(asia_indicator_sdg4_hdr_mys_gender %>% select(contains('hdr_mys_f'))),
    
    # Rate of change
    rate_of_change_m = calculate_rate_of_change(asia_indicator_sdg4_hdr_mys_gender %>% select(contains('hdr_mys_m'))), 
    rate_of_change_f = calculate_rate_of_change(asia_indicator_sdg4_hdr_mys_gender %>% select(contains('hdr_mys_f')))
  )

# AFRICA
africa_indicator_sdg4_hdr_mys <- africa_indicator %>% select(country_name, country_code_iso3, num_range('hdr_mys_', year)) %>% drop_na()

africa_indicator_sdg4_hdr_mys_gender <- africa_indicator %>% select(country_name, country_code_iso3, num_range('hdr_mys_m_', year), num_range('hdr_mys_f_', year)) %>% drop_na()

# Parameters
africa_indicator_sdg4_hdr_mys <- africa_indicator_sdg4_hdr_mys %>%
  mutate(
    # Mean
    mean_m = rowMeans(africa_indicator_sdg4_hdr_mys %>% select(contains('hdr_mys'))), 
    
    # Rate of change
    rate_of_change = calculate_rate_of_change(africa_indicator_sdg4_hdr_mys %>% select(contains('hdr_mys'))), 
  )

africa_indicator_sdg4_hdr_mys_gender <- africa_indicator_sdg4_hdr_mys_gender %>%
  mutate(
    # Mean
    mean_m = rowMeans(africa_indicator_sdg4_hdr_mys_gender %>% select(contains('hdr_mys_m'))), 
    mean_f = rowMeans(africa_indicator_sdg4_hdr_mys_gender %>% select(contains('hdr_mys_f'))), 
    
    # Rate of change
    rate_of_change_m = calculate_rate_of_change(africa_indicator_sdg4_hdr_mys_gender %>% select(contains('hdr_mys_m'))), 
    rate_of_change_f = calculate_rate_of_change(africa_indicator_sdg4_hdr_mys_gender %>% select(contains('hdr_mys_f')))
  )

```
## Get SDG Current Progress for Asia and Africa (Q2)
```{r}
# Join Report and Region Based on Country Codes
sdg_report <- inner_join(x=sdg_report, y=country_region_name_code, by='country_code_iso3')

sdg_report <- sdg_report %>% select(region, country_name, country_code_iso3,  everything())

asia_report_sdg <- sdg_report %>% filter(region == "Asia")
africa_report_sdg <- sdg_report %>% filter(region == "Africa")

# Asian Country SDG Report
asia_report_sdg1 <- asia_report_sdg %>%
  rename(dash = Goal.1.Dash, trend = Goal.1.Trend, score = Goal.1.Score) %>%
  select(country_code_iso3, dash, trend, score) %>%
  filter(!is.na(dash), !is.na(trend), !is.na(score))

asia_report_sdg3 <- asia_report_sdg %>%
  rename(dash = Goal.3.Dash, trend = Goal.3.Trend, score = Goal.3.Score) %>%
  select(country_code_iso3, dash, trend, score) %>%
  filter(!is.na(dash), !is.na(trend), !is.na(score))

asia_report_sdg4 <- asia_report_sdg %>%
  rename(dash = Goal.4.Dash, trend = Goal.4.Trend, score = Goal.4.Score) %>%
  select(country_code_iso3, dash, trend, score) %>%
  filter(!is.na(dash), !is.na(trend), !is.na(score))

asia_report_sdg <- tibble(
  sdg = c('SDG1', 'SDG3', 'SDG4'),
  mean_score = c(mean(asia_report_sdg1$score),
  mean(asia_report_sdg3$score),
  mean(asia_report_sdg4$score))
  )

# African Country SDG Report
africa_report_sdg1 <- africa_report_sdg %>%
  rename(dash = Goal.1.Dash, trend = Goal.1.Trend, score = Goal.1.Score) %>%
  select(country_code_iso3, dash, trend, score) %>%
  filter(!is.na(dash), !is.na(trend), !is.na(score))

africa_report_sdg3 <- africa_report_sdg %>%
  rename(dash = Goal.3.Dash, trend = Goal.3.Trend, score = Goal.3.Score) %>%
  select(country_code_iso3, dash, trend, score) %>%
  filter(!is.na(dash), !is.na(trend), !is.na(score))

africa_report_sdg4 <- africa_report_sdg %>%
  rename(dash = Goal.4.Dash, trend = Goal.4.Trend, score = Goal.4.Score) %>%
  select(country_code_iso3, dash, trend, score) %>%
  filter(!is.na(dash), !is.na(trend), !is.na(score))

africa_report_sdg <- tibble(
  sdg = c('SDG1', 'SDG3', 'SDG4'),
  mean_score = c(mean(africa_report_sdg1$score),
  mean(africa_report_sdg3$score),
  mean(africa_report_sdg4$score))
  )

```


#### Data Analysis ####

# Research Question 1: How do the “current” socio-economic and cultural backgrounds of Asian and African countries influence their progress towards achieving SDG 1, SDG 3, and SDG 4 ?

Linear Regression:
We conducted linear regression to find the correlations between social economic background and the SDG scores. We chose some indicators for the background variables; "hdr_gnipc_2021" for SDG1, "health_score" for SDG3, and "hdr_mys_2021" for SDG4. "Health score" is obtained with the sum of values of the sowc_child_health variables. Those variables are the independent variables. "score" is the response variable for all the linear regressions.

#Linear Regression for Asia:
```{r}
## ASIA
## SDG1
correlation_data_1 <- full_join(x=asia_indicator_sdg1_hdr_gnipc, y=asia_report_sdg1, by="country_code_iso3",'')
correlation_data_1 <- correlation_data_1 %>% select(hdr_gnipc_2021, score) %>% drop_na()

linear_model <- lm(score ~ hdr_gnipc_2021, data = correlation_data_1)
print("Asia SDG1 Summary")
summary(linear_model)

ggplot(correlation_data_1, aes(x = hdr_gnipc_2021, y = score)) +
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "Asia Linear Regression of Gross National Income Per Capita vs. SDG1 Score",
       x = "Gross National Income Per Capita ($)",
       y = "Score") +
  theme_minimal()


## SDG3
asia_indicator_sdg3_sowc_child_health <- asia_indicator_sdg3_sowc_child_health %>% replace(is.na(.), 0) %>%
  mutate(health_score = rowSums(pick(where(is.numeric))))

correlation_data_3 <- full_join(x=asia_indicator_sdg3_sowc_child_health, y=asia_report_sdg3, by="country_code_iso3")
correlation_data_3 <- correlation_data_3 %>% 
  select(health_score, score) %>% 
  drop_na() %>% 
  filter(health_score > 500) # Remove outliers

linear_model <- lm(score ~ health_score, data = correlation_data_3)
print("Asia SDG3 Summary")
summary(linear_model)

ggplot(correlation_data_3, aes(x = health_score, y = score)) +
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "Asia Linear Regression of Health Score vs. SDG3 Score",
       x = "Health Score",
       y = "SDG3 Score") +
  theme_minimal()

correlation_data_4 <- full_join(x=asia_indicator_sdg4_hdr_mys, y=asia_report_sdg4, by="country_code_iso3")
correlation_data_4 <- correlation_data_4 %>% select(hdr_mys_2021, score) %>% drop_na()

linear_model <- lm(score ~ hdr_mys_2021, data = correlation_data_4)
print("Asia SDG4 Summary")
summary(linear_model)

ggplot(correlation_data_4, aes(x = hdr_mys_2021, y = score)) +
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "Asia Linear Regression of Mean Years of Schooling vs. SDG4 Score",
       x = "Mean Years of Schooling",
       y = "SDG4 Score") +
  theme_minimal()

#calculating r
cor(x=correlation_data_1$hdr_gnipc_2021, y=correlation_data_1$score)
cor(x=correlation_data_3$health_score, y=correlation_data_3$score)
cor(x=correlation_data_4$hdr_mys_2021, y=correlation_data_4$score)

```
The fitted model for SDG1, Asia
$$\hat{y_i} = 7.446e^1 + 7.312e^-4 x_i$$
Thw fitted model for SDG3, Asia:
$$\hat{y_i} = 80.206894  -0.007152x_i$$
The fitted model for SDG4, Asia:
$$\hat{y_i} = 53.2209 + 3.3214 x_i$$
The correlation between hdr_gnipc_2021 and SDG1 score is approximately 0.470
The correlation between Health Score and SDG3 score is approximately -0.072
The correlation between hdr_mys_2021 and SDG4 score is approximately 0.577

#Linear Regression for Africa
```{r}
## AFRICA
## SDG1
correlation_data_1 <- full_join(x=africa_indicator_sdg1_hdr_gnipc, y=africa_report_sdg1, by="country_code_iso3",'')
correlation_data_1 <- correlation_data_1 %>% select(hdr_gnipc_2021, score) %>% drop_na()

linear_model <- lm(score ~ hdr_gnipc_2021, data = correlation_data_1)
print("Africa SDG1 Summary")
summary(linear_model)

ggplot(correlation_data_1, aes(x = hdr_gnipc_2021, y = score)) +
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "Africa Linear Regression of Gross National Income Per Capita vs. SDG1 Score",
       x = "Gross National Income Per Capita ($)",
       y = "Score") +
  theme_minimal()


## SDG3
africa_indicator_sdg3_sowc_child_health <- africa_indicator_sdg3_sowc_child_health %>% replace(is.na(.), 0) %>%
  mutate(health_score = rowSums(pick(where(is.numeric))))

correlation_data_3 <- full_join(x=africa_indicator_sdg3_sowc_child_health, y=africa_report_sdg3, by="country_code_iso3")
correlation_data_3 <- correlation_data_3 %>% 
  select(health_score, score) %>% 
  drop_na() %>% 
  filter(health_score > 500) # Remove outliers

linear_model <- lm(score ~ health_score, data = correlation_data_3)
print("Africa SDG3 Summary")
summary(linear_model)

ggplot(correlation_data_3, aes(x = health_score, y = score)) +
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "Africa Linear Regression of health_score vs. SDG3 Score",
       x = "Health Score",
       y = "SDG3 Score") +
  theme_minimal()

correlation_data_4 <- full_join(x=africa_indicator_sdg4_hdr_mys, y=africa_report_sdg4, by="country_code_iso3")
correlation_data_4 <- correlation_data_4 %>% select(hdr_mys_2021, score) %>% drop_na()

linear_model <- lm(score ~ hdr_mys_2021, data = correlation_data_4)
print("Africa SDG4 Summary")
summary(linear_model)

ggplot(correlation_data_4, aes(x = hdr_mys_2021, y = score)) +
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "Africa Linear Regression of hdr_mys vs. SDG4 Score",
       x = "Mean Years of Schooling",
       y = "SDG4 Score") +
  theme_minimal()

#calculating r
cor(x=correlation_data_1$hdr_gnipc_2021, y=correlation_data_1$score)
cor(x=correlation_data_3$health_score, y=correlation_data_3$score)
cor(x=correlation_data_4$hdr_mys_2021, y=correlation_data_4$score)

```
The fitted model for SDG1:
$$\hat{y_i} = 2.330e^1 + 4.592e^-3 x_i$$
The fitted model for SDG3:
$$\hat{y_i} = 15.748420 + 0.007408x_i$$
The fitted model for SDG4:
$$\hat{y_i} = 14.330 + 6.513 x_i$$
The correlation between hdr_gnipc_2021 and SDG1 score is approximately 0.714
The correlation between Health Score and SDG3 score is approximately 0.350
The correlation between hdr_mys_2021 and SDG4 score is approximately 0.675

Hypothesis Testing

We conduct our null hypothesis based across the regions and SDGs the with the following
$H_0$: The slope parameter is zero
$H_1$: The slope parameter is different from zero
with alpha level of 0.01

Based on our summary table, we obtained that for
Asia: 
- P-value for SDG1 linear regression: 0.0038
  Hence, we are rejecting the null hypothesis and there is a correlation 

- P-value for SDG3 linear regression: 0.6341
  Hence, there is no evidence against the null hypothesis and there is no correlation

- P-value for SDG4 linear regression: 2.661e-05
  Hence, we are rejecting the null hypothesis and there is a correlation 
  
Africa:
- P-value for SDG1 linear regression: 2.506e-08
  Hence, we are rejecting the null hypothesis and there is a correlation 
  
- P-value for SDG3 linear regression: 0.002
  Hence, we are rejecting the null hypothesis and there is a correlation 
  
- P-value for SDG4 linear regression: 3.745e-07
  Hence, we are rejecting the null hypothesis and there is a correlation
  
Therefore, based on our hypothesis tests, the background of countries in Asia and Africa has a correlation to the SDG scores for the countries. 


Bootstrappings:
we conducted six bootstrapping analyses to compare the strength of social-economic background. We constructed a 90% confidence interval for the background variables. This involves randomly sampling (with replacement) the values of background variables and computing the means, which are our test statistics. Repeated sampling will provide an estimate of the bootstrap sampling distributions, which we will visualize as box plots for easy comparison between regions. Lastly, we will calculate the confidence intervals using quantiles, offering a clear range for the means of each background variable.

```{r}
##SDG1
#ASIA
asia_sdg1_background <- full_join(x=asia_indicator_sdg1_hdr_gnipc, y=asia_report_sdg1, by="country_code_iso3",'') %>% select(hdr_gnipc_2021) %>% drop_na()

set.seed(10000)

boot_sim_asia1 <- rep(NA, 2000)

for (i in 1:2000)
{
  boot_s1_asia <- asia_sdg1_background %>% sample_n(size=100, replace=TRUE)
  boot_sim_asia1[i] <- as.numeric(boot_s1_asia %>% summarize(mean(hdr_gnipc_2021)))
}

data_q1_1 <- data.frame(estimate = boot_sim_asia1)
data_q1_1$region = "ASIA"

#AFRICA
africa_sdg1_background <- full_join(x=africa_indicator_sdg1_hdr_gnipc, y=africa_report_sdg1, by="country_code_iso3",'') %>% select(hdr_gnipc_2021) %>% drop_na()

set.seed(10000)

boot_sim_africa1 <- rep(NA, 2000)

for (i in 1:2000)
{
  boot_s1_africa <- africa_sdg1_background %>% sample_n(size=100, replace=TRUE)
  boot_sim_africa1[i] <- as.numeric(boot_s1_africa %>% summarize(mean(hdr_gnipc_2021)))
}

data_q1_2 <- data.frame(estimate = boot_sim_africa1)
data_q1_2$region = "AFRICA"

q1_new_data1 <- rbind(data_q1_1, data_q1_2)

### Visualizations
ggplot(data = q1_new_data1, aes(x=estimate, y=region)) + geom_boxplot(color="black",fill="gray") + labs(x = "means of hdr_gnipc_2021 values for SDG1")

##SDG3
#ASIA
asia_sdg3_background <- full_join(x=asia_indicator_sdg3_sowc_child_health, y=asia_report_sdg3, by="country_code_iso3") %>% 
  select(health_score, score) %>% 
  drop_na() %>% 
  filter(health_score > 500) # Remove outliers

set.seed(10000)

boot_sim_asia3 <- rep(NA, 2000)

for (i in 1:2000)
{
  boot_s3_asia <- asia_sdg3_background %>% sample_n(size=100, replace=TRUE)
  boot_sim_asia3[i] <- as.numeric(boot_s3_asia %>% summarize(mean(health_score)))
}

data_q1_3 <- data.frame(estimate = boot_sim_asia3)
data_q1_3$region = "ASIA"

#AFRICA
africa_sdg3_background <- full_join(x=africa_indicator_sdg3_sowc_child_health, y=africa_report_sdg3, by="country_code_iso3") %>% 
  select(health_score, score) %>% 
  drop_na() %>% 
  filter(health_score > 500) # Remove outliers

set.seed(10000)

boot_sim_africa3 <- rep(NA, 2000)

for (i in 1:2000)
{
  boot_s3_africa <- africa_sdg3_background %>% sample_n(size=100, replace=TRUE)
  boot_sim_africa3[i] <- as.numeric(boot_s3_africa %>% summarize(mean(health_score)))
}

data_q1_4 <- data.frame(estimate = boot_sim_africa3)
data_q1_4$region = "AFRICA"

q1_new_data2 <- rbind(data_q1_3, data_q1_4)

### Visualizations
ggplot(data = q1_new_data2, aes(x=estimate, y=region)) + geom_boxplot(color="black",fill="gray") + labs(x = "means of health_score values for SDG3")


##SDG4
#ASIA
asia_sdg4_background <- full_join(x=asia_indicator_sdg4_hdr_mys, y=asia_report_sdg4, by="country_code_iso3") %>% select(hdr_mys_2021, score) %>% drop_na()

set.seed(10000)

boot_sim_asia4 <- rep(NA, 2000)

for (i in 1:2000)
{
  boot_s4_asia <- asia_sdg4_background %>% sample_n(size=100, replace=TRUE)
  boot_sim_asia4[i] <- as.numeric(boot_s4_asia %>% summarize(mean(hdr_mys_2021)))
}

data_q1_5 <- data.frame(estimate = boot_sim_asia4)
data_q1_5$region = "ASIA"

#AFRICA
africa_sdg4_background <- full_join(x=africa_indicator_sdg4_hdr_mys, y=africa_report_sdg4, by="country_code_iso3") %>% select(hdr_mys_2021, score) %>% drop_na()

set.seed(10000)

boot_sim_africa4 <- rep(NA, 2000)

for (i in 1:2000)
{
  boot_s4_africa <- africa_sdg4_background %>% sample_n(size=100, replace=TRUE)
  boot_sim_africa4[i] <- as.numeric(boot_s4_africa %>% summarize(mean(hdr_mys_2021)))
}

data_q1_6 <- data.frame(estimate = boot_sim_africa4)
data_q1_6$region = "AFRICA"

q1_new_data3 <- rbind(data_q1_5, data_q1_6)

### Visualizations
ggplot(data = q1_new_data3, aes(x=estimate, y=region)) + geom_boxplot(color="black",fill="gray") + labs(x = "means of hdr_mys_2021 values for SDG4")
```

# Calculate Quantiles (90% Confidence Interval)
```{r}
# ASIA - SDG1
quantile(data_q1_1$estimate, c(0.05, 0.5, 0.95))
# AFRICA - SDG1
quantile(data_q1_2$estimate, c(0.05, 0.5, 0.95))
# ASIA - SDG3
quantile(data_q1_3$estimate, c(0.05, 0.5, 0.95))
# AFRICA - SDG3
quantile(data_q1_4$estimate, c(0.05, 0.5, 0.95))
# ASIA - SDG4
quantile(data_q1_5$estimate, c(0.05, 0.5, 0.95))
# AFRICA - SDG4
quantile(data_q1_6$estimate, c(0.05, 0.5, 0.95))

```

Based on the quantiles, we conclude that this region has more strength in the background.

Therefore, from correlation analysis (linear regression/hypothesis tests) and bootstrapping(stregth of background), we can say that social-economic backgrounds influence the SDGs and the stronger the background is, the more progress toward SDGs.

Overall, this region has the stronger background.






# Research Question 2: How is the current progress of Asian countries towards achieving SDG1, SDG3, and SDG4 compared to African countries?

## Mean Sampling Analysis
```{r}
# ASIA - SDG1
sample_means <- rep(NA, 1000)

for (i in 1:1000) {
  sample25 <- asia_report_sdg1 %>% sample_n(size=25)
  sample_means[i] <-as.numeric(sample25 %>% summarise(mean(score)))
}

sample_means <- tibble(mean_score = sample_means)
ggplot(sample_means, aes(x=mean_score)) + 
  geom_histogram(color="black", fill="gray") +
  labs(x="Means from sample size 25", 
       title="Sampling Distribution for Mean of Asia SDG1 Score")


# ASIA - SDG3
sample_means <- rep(NA, 1000)

for (i in 1:1000) {
  sample25 <- asia_report_sdg3 %>% sample_n(size=25)
  sample_means[i] <-as.numeric(sample25 %>% summarise(mean(score)))
}

sample_means <- tibble(mean_score = sample_means)

ggplot(sample_means, aes(x=mean_score)) + 
  geom_histogram(color="black", fill="gray") +
  labs(x="Means from sample size 25", 
       title="Sampling Distribution for Mean of Asia SDG3 Score")


# ASIA - SDG4
sample_means <- rep(NA, 1000)

for (i in 1:1000) {
  sample25 <- asia_report_sdg4 %>% sample_n(size=25)
  sample_means[i] <-as.numeric(sample25 %>% summarise(mean(score)))
}

sample_means <- tibble(mean_score = sample_means)
ggplot(sample_means, aes(x=mean_score)) + 
  geom_histogram(color="black", fill="gray") +
  labs(x="Means from sample size 25", 
       title="Sampling Distribution for Mean of Asia SDG Score")


```

## Mean Bootstrapping Analysis
We aim to measure Bootstrap Confidence Intervals to estimate the possible range of progress for SDG1, SDG3, and SDG4 in Asian and African countries. This method will help us ascertain the range within which the true mean progress scores for these SDGs in Asia fall, with a 90% confidence level. Similarly, we will determine this range for African countries, enabling a comparative analysis of mean progress between the two regions.


```{r}
set.seed(10000)

# ASIA - SDG1
asia_boot_means_sdg1 <- rep(NA, 1000)

for (i in 1:1000) {
  boot_samp <- asia_report_sdg1 %>% sample_n(size=200, replace=TRUE)
  asia_boot_means_sdg1[i] <-as.numeric(boot_samp %>% summarise(mean(score)))
}

asia_boot_means_sdg1 <- tibble(mean_score = asia_boot_means_sdg1)

ggplot(asia_boot_means_sdg1, aes(x=mean_score)) + 
  geom_histogram(color="black", fill="gray") +
  labs(x="Means from bootstrap sample", 
       title="Sampling Distribution for Mean of Asia SDG1 Score")


# ASIA - SDG3
asia_boot_means_sdg3 <- rep(NA, 1000)

for (i in 1:1000) {
  boot_samp <- asia_report_sdg3 %>% sample_n(size=200, replace=TRUE)
  asia_boot_means_sdg3[i] <-as.numeric(boot_samp %>% summarise(mean(score)))
}

asia_boot_means_sdg3 <- tibble(mean_score = asia_boot_means_sdg3)

ggplot(asia_boot_means_sdg3, aes(x=mean_score)) + 
  geom_histogram(color="black", fill="gray") +
  labs(x="Means from bootstrap sample", 
       title="Sampling Distribution for Mean of Asia SDG3 Score")


# ASIA - SDG4
asia_boot_means_sdg4 <- rep(NA, 1000)

for (i in 1:1000) {
  boot_samp <- asia_report_sdg4 %>% sample_n(size=200, replace=TRUE)
  asia_boot_means_sdg4[i] <-as.numeric(boot_samp %>% summarise(mean(score)))
}

asia_boot_means_sdg4 <- tibble(mean_score = asia_boot_means_sdg4)

ggplot(asia_boot_means_sdg4, aes(x=mean_score)) + 
  geom_histogram(color="black", fill="gray") +
  labs(x="Means from bootstrap sample", 
       title="Sampling Distribution for Mean of Asia SDG4 Score")


# AFRICA - SDG1
africa_boot_means_sdg1 <- rep(NA, 1000)

for (i in 1:1000) {
  boot_samp <- africa_report_sdg1 %>% sample_n(size=200, replace=TRUE)
  africa_boot_means_sdg1[i] <-as.numeric(boot_samp %>% summarise(mean(score)))
}

africa_boot_means_sdg1 <- tibble(mean_score = africa_boot_means_sdg1)

ggplot(africa_boot_means_sdg1, aes(x=mean_score)) + 
  geom_histogram(color="black", fill="gray") +
  labs(x="Means from bootstrap sample", 
       title="Sampling Distribution for Mean of Africa SDG1 Score")


# AFRICA - SDG3
africa_boot_means_sdg3 <- rep(NA, 1000)

for (i in 1:1000) {
  boot_samp <- africa_report_sdg3 %>% sample_n(size=200, replace=TRUE)
  africa_boot_means_sdg3[i] <-as.numeric(boot_samp %>% summarise(mean(score)))
}

africa_boot_means_sdg3 <- tibble(mean_score = africa_boot_means_sdg3)

ggplot(africa_boot_means_sdg3, aes(x=mean_score)) + 
  geom_histogram(color="black", fill="gray") +
  labs(x="Means from bootstrap sample", 
       title="Sampling Distribution for Mean of Africa SDG3 Score")


# AFRICA - SDG4
africa_boot_means_sdg4 <- rep(NA, 1000)

for (i in 1:1000) {
  boot_samp <- africa_report_sdg4 %>% sample_n(size=200, replace=TRUE)
  africa_boot_means_sdg4[i] <-as.numeric(boot_samp %>% summarise(mean(score)))
}

africa_boot_means_sdg4 <- tibble(mean_score = africa_boot_means_sdg4)

ggplot(africa_boot_means_sdg4, aes(x=mean_score)) + 
  geom_histogram(color="black", fill="gray") +
  labs(x="Means from bootstrap sample", 
       title="Sampling Distribution for Mean of Africa SDG4 Score")


```

# Calculate Quantiles (95% Confidence Interval)
```{r}
# ASIA - SDG1
quantile(asia_boot_means_sdg1$mean_score, c(0.025, 0.5, 0.975))
# ASIA - SDG3
quantile(asia_boot_means_sdg3$mean_score, c(0.025, 0.5, 0.975))
# ASIA - SDG4
quantile(asia_boot_means_sdg4$mean_score, c(0.025, 0.5, 0.975))
# AFRICA - SDG1
quantile(africa_boot_means_sdg1$mean_score, c(0.025, 0.5, 0.975))
# AFRICA - SDG3
quantile(africa_boot_means_sdg3$mean_score, c(0.025, 0.5, 0.975))
# AFRICA - SDG4
quantile(africa_boot_means_sdg4$mean_score, c(0.025, 0.5, 0.975))

```

```{r}
# ASIA - SDG1
ggplot(asia_boot_means_sdg1, aes(x=mean_score)) +
  geom_histogram(fill="tan2", color="black") + 
  labs(x="Means from bootstrap samples", 
       title="Bootstrap Sampling Distribution for Asia SDG1 Mean") + 
  geom_vline(xintercept=quantile(asia_boot_means_sdg1$mean_score, 0.025), col="blue") +
  geom_vline(xintercept=quantile(asia_boot_means_sdg1$mean_score, 0.975), col="blue")

# ASIA - SDG3
ggplot(asia_boot_means_sdg3, aes(x=mean_score)) +
  geom_histogram(fill="tan2", color="black") + 
  labs(x="Means from bootstrap samples", 
       title="Bootstrap Sampling Distribution for Asia SDG3 Mean") + 
  geom_vline(xintercept=quantile(asia_boot_means_sdg3$mean_score, 0.025), col="blue") +
  geom_vline(xintercept=quantile(asia_boot_means_sdg3$mean_score, 0.975), col="blue")

# ASIA - SDG4
ggplot(asia_boot_means_sdg4, aes(x=mean_score)) +
  geom_histogram(fill="tan2", color="black") + 
  labs(x="Means from bootstrap samples", 
       title="Bootstrap Sampling Distribution for Asia SDG4 Mean") + 
  geom_vline(xintercept=quantile(asia_boot_means_sdg4$mean_score, 0.025), col="blue") +
  geom_vline(xintercept=quantile(asia_boot_means_sdg4$mean_score, 0.975), col="blue")

# AFRICA - SDG1
ggplot(africa_boot_means_sdg1, aes(x=mean_score)) +
  geom_histogram(fill="tan2", color="black") + 
  labs(x="Means from bootstrap samples", 
       title="Bootstrap Sampling Distribution for Africa SDG1 Mean") + 
  geom_vline(xintercept=quantile(africa_boot_means_sdg1$mean_score, 0.025), col="blue") +
  geom_vline(xintercept=quantile(africa_boot_means_sdg1$mean_score, 0.975), col="blue")

# AFRICA - SDG3
ggplot(africa_boot_means_sdg3, aes(x=mean_score)) +
  geom_histogram(fill="tan2", color="black") + 
  labs(x="Means from bootstrap samples", 
       title="Bootstrap Sampling Distribution for Africa SDG3 Mean") + 
  geom_vline(xintercept=quantile(africa_boot_means_sdg3$mean_score, 0.025), col="blue") +
  geom_vline(xintercept=quantile(africa_boot_means_sdg3$mean_score, 0.975), col="blue")

# AFRICA - SDG4
ggplot(africa_boot_means_sdg4, aes(x=mean_score)) +
  geom_histogram(fill="tan2", color="black") + 
  labs(x="Means from bootstrap samples", 
       title="Bootstrap Sampling Distribution for Africa SDG4 Mean") + 
  geom_vline(xintercept=quantile(africa_boot_means_sdg4$mean_score, 0.025), col="blue") +
  geom_vline(xintercept=quantile(africa_boot_means_sdg4$mean_score, 0.975), col="blue")


```
Based on calculations and graph visualization, we obtain that the mean SDG score with 90% confidence interval is below. 
 
The mean of SDG1 score for regions in Asia lies between 83.7 and 89.6. In contrast, the mean of SDG1 score for regions in Africa lies between 39.7 and 48.0. Therefore, the SDG1 score for regions in Asia is greater than Africa. 

The mean of SDG3 score for regions in Asia lies between 71.7 and 75.5. In contrast, the mean of SDG3 score for regions in Africa lies between 44.5 and 48.7. Therefore, the SDG3 score for regions in Asia is greater than Africa.

The mean of SDG4 score for regions in Asia lies between 81.4 and 85.5. In contrast, the mean of SDG4 score for regions in Africa lies between 48.6 and 54.6. Therefore, the SDG4 score for regions in Asia is greater than Africa.

Hence, for SDG1, SDG3, and SDG4 the mean score for Asia is greater than Africa based on the bootstrapping result for which the SDGs scores are generally located. 


## Hypothesis Testing (Asia vs. Africa)
# SDG1 - 2-Sided Hypothesis
The 2-sided hypothesis test will be conducted with the following:

$H_0$: There is no difference in mean of SDG1 Score
$H_1$: There is a difference in mean of SDG1 Score

Population: Asia and Africa SDG1 Score Data
Test statistics: Asia SDG1 Mean Score - Africa SDG1 Mean Score

```{r}
asia_africa_sdg1_report <- sdg_report %>% filter(region == "Asia" | region == "Africa") %>%
  select(region, country_name, Goal.1.Dash, Goal.1.Trend, Goal.1.Score) %>%
  rename(dash = Goal.1.Dash, trend = Goal.1.Trend, score = Goal.1.Score) %>%
  drop_na()
  
asia_africa_sdg1_report %>% select(region, score) %>%
  mutate(region=sample(region))


# simulation info
num_trials <- 1000  # number of simulated values
# random seed
set.seed(130)
# simulate!
delta_mean_simulations <- rep(NA, num_trials)
for(i in 1:num_trials){
  # perform a random permutation
  simdata <- 
    asia_africa_sdg1_report %>% 
    mutate(group = sample(region, replace=FALSE))
  # compute the simulated test statistic
  delta_mean_sim <- 
    simdata %>% 
    group_by(group) %>%
    summarise(means = mean(score), .groups="drop") %>%
    summarise(value = diff(means)) %>%
    as.numeric()
  # store the simulated value
  delta_mean_simulations[i] <- delta_mean_sim
}

asia_africa_sdg1_simulation_results <- tibble(mean_diff = delta_mean_simulations)

asia_africa_sdg1_simulation_results %>%
  ggplot(aes(x = mean_diff)) +
  geom_histogram(bins=30, color="black", fill="gray") +
  labs(x = "Differences", title= "Differences in SDG1 Score between Asia and Africa from Random Permutations")


# calculate 2-sided p-value
delta_mean_null <- 0  # null hypothesis value
delta_mean_obs <- abs(asia_report_sdg$mean_score[1] - africa_report_sdg$mean_score[1]) 
# test statistics
asia_report_sdg$mean_score[1]
# absolute mean difference of the observed mean

pvalue_2side <- 
  sum(abs(delta_mean_simulations - delta_mean_null) >= 
      abs(delta_mean_obs - delta_mean_null)) / num_trials

print("p-value")
print(pvalue_2side)

# run hypothesis test

alpha <- 0.05  # alpha level
reject_null <- pvalue_2side < alpha  # reject the null?

print("Reject Null")
print(reject_null)

```
Based on the hypothesis test, we obtain that the p-value we obtained under the null hypothesis is 0. Hence, there is a strong evidence against the null hypothesis. Therefore, we can conclude that there is a difference between the mean of SDG1 score for Asia and Africa. 


# SDG3 - 2-Sided Hypothesis
The 2-sided hypothesis test will be conducted with the following:

$H_0$: There is no difference in mean of SDG3 Score
$H_1$: There is a difference in mean of SDG3 Score

Population: Asia and Africa SDG3 Score Data
Test statistics: Asia SDG3 Mean Score - Africa SDG3 Mean Score

```{r}
print("H0: There is no difference in mean of SDG3 Score")
print("H1: There is a difference in mean of SDG3 Score")

asia_africa_sdg3_report <- sdg_report %>% filter(region == "Asia" | region == "Africa") %>%
  select(region, country_name, Goal.3.Dash, Goal.3.Trend, Goal.3.Score) %>%
  rename(dash = Goal.3.Dash, trend = Goal.3.Trend, score = Goal.3.Score) %>%
  drop_na()

asia_africa_sdg3_report %>% select(region, score) %>%
  mutate(region=sample(region))

# simulation info
num_trials <- 1000  # number of simulated values
# random seed
set.seed(130)
# simulate!
delta_mean_simulations <- rep(NA, num_trials)
for(i in 1:num_trials){
  # perform a random permutation
  simdata <- 
    asia_africa_sdg3_report %>% 
    mutate(group = sample(region, replace=FALSE))
  # compute the simulated test statistic
  delta_mean_sim <- 
    simdata %>% 
    group_by(group) %>%
    summarise(means = mean(score), .groups="drop") %>%
    summarise(value = diff(means)) %>%
    as.numeric()
  # store the simulated value
  delta_mean_simulations[i] <- delta_mean_sim
}

asia_africa_sdg3_simulation_results <- tibble(mean_diff = delta_mean_simulations)
asia_africa_sdg3_simulation_results

asia_africa_sdg3_simulation_results %>%
  ggplot(aes(x = mean_diff)) +
  geom_histogram(bins=30, color="black", fill="gray") +
  labs(x = "Differences", title= "Differences in SDG3 Score between Asia and Africa from Random Permutations")

# calculate 2-sided p-value
delta_mean_null <- 0  # null hypothesis value
delta_mean_obs <- abs(asia_report_sdg$mean_score[2] - africa_report_sdg$mean_score[2]) # absolute mean difference of the observed mean

pvalue_2side <- 
  sum(abs(delta_mean_simulations - delta_mean_null) >= 
      abs(delta_mean_obs - delta_mean_null)) / num_trials

print("P-Value")
print(pvalue_2side)

# run hypothesis test

alpha <- 0.001  # alpha level
reject_null <- pvalue_2side < alpha  # reject the null?

print("Reject Null")
print(reject_null)

```
Based on the hypothesis test, we obtain that the p-value we obtained under the null hypothesis is 0. Hence, there is a strong evidence against the null hypothesis. Therefore, we can conclude that there is a difference between the mean of SDG3 score for Asia and Africa. 

# SDG4 - 2-Sided Hypothesis
The 2-sided hypothesis test will be conducted with the following:

$H_0$: There is no difference in mean of SDG4 Score
$H_1$: There is a difference in mean of SDG4 Score

Population: Asia and Africa SDG4 Score Data
Test statistics: Asia SDG4 Mean Score - Africa SDG4 Mean Score

```{r}
asia_africa_sdg4_report <- sdg_report %>% filter(region == "Asia" | region == "Africa") %>%
  select(region, country_name, Goal.4.Dash, Goal.4.Trend, Goal.4.Score) %>%
  rename(dash = Goal.4.Dash, trend = Goal.4.Trend, score = Goal.4.Score) %>%
  drop_na()

asia_africa_sdg4_report %>% select(region, score) %>%
  mutate(region=sample(region))

# simulation info
num_trials <- 1000  # number of simulated values
# random seed
set.seed(130)
# simulate!
delta_mean_simulations <- rep(NA, num_trials)
for(i in 1:num_trials){
  # perform a random permutation
  simdata <- 
    asia_africa_sdg4_report %>% 
    mutate(group = sample(region, replace=FALSE))
  # compute the simulated test statistic
  delta_mean_sim <- 
    simdata %>% 
    group_by(group) %>%
    summarise(means = mean(score), .groups="drop") %>%
    summarise(value = diff(means)) %>%
    as.numeric()
  # store the simulated value
  delta_mean_simulations[i] <- delta_mean_sim
}

asia_africa_sdg4_simulation_results <- tibble(mean_diff = delta_mean_simulations)

asia_africa_sdg4_simulation_results %>%
  ggplot(aes(x = mean_diff)) +
  geom_histogram(bins=30, color="black", fill="gray") +
  labs(x = "Differences", title= "Differences in SDG4 Score between Asia and Africa from Random Permutations")

pvalue_2side <- 
  sum(abs(delta_mean_simulations - delta_mean_null) >= 
      abs(delta_mean_obs - delta_mean_null)) / num_trials

print("P-Value")
print(pvalue_2side)

# run hypothesis test

alpha <- 0.001  # alpha level
reject_null <- pvalue_2side < alpha  # reject the null?

print("Reject Null")
print(reject_null)

```
Based on the hypothesis test, we obtain that the p-value we obtained under the null hypothesis is 0. Hence, there is a strong evidence against the null hypothesis. Therefore, we can conclude that there is a difference between the mean of SDG4 score for Asia and Africa. 

#Conclusion for Research Question 2
Summary:
SDG1:
  Bootstrapping: Asia has higher SDG1 score
  Hypothesis Test: there is difference in SDG1 score between Asia and Africa
SDG3:
  Bootstrapping: Asia has higher SDG3 score
  Hypothesis Test: there is difference in SDG3 score between Asia and Africa
SDG4:
  Bootstrapping: Asia has higher SDG4 score
  Hypothesis Test: there is difference in SDG4 score between Asia and Africa
  
Conclusion:
Asian countries has greater progress in SDG1, SDG3, SDG4 scores compared to African countries. Hence, Asia has greater progress in achieving the overall well-being of children compared to Africa. 


#Research Question 3: Which regions, Asia or Africa can we predict to have more progress toward SDG1, 3, 4?

To predict the progress, we calculated the rate of progress (2010 to 2021) and compare between Asia and Africa. We conducted Bootstrappings and Hypothesis Tests. We will mainly focus on Bootstrappings to get result with actual values (comparison in confidence intervals) and use hypothesis Test to support the results obtained by Bootstrappings (is there actually difference between Asia and Africa?)

We chose one of the indicators from each SDG and calculated the rate of progress; we computed the scores in 2021 minus scores in 2010 and divide them by the number of years (2021 minus 2010)

#Research Question 3: Data

Below are the lists of the datasets that we used for Bootstrappings and Hypothesis Tests. 

```{r}
###SDG1 
## UNDP's Human Development Report ###
# Gross National Income Per Capital
asia_indicator_sdg1_hdr_gnipc
africa_indicator_sdg1_hdr_gnipc
###SDG3
## UNDP’s Human Development Report
# Life Expectancy
asia_indicator_sdg3_hdr_life_expectancy
africa_indicator_sdg3_hdr_life_expectancy
###SDG4
## UNDP's Human Development Report
# Mean Years of Schooling
asia_indicator_sdg4_hdr_mys
africa_indicator_sdg4_hdr_mys

```

Bootstrappings: we conducted six bootstrapping analyses - two for each SDG. We constructed a 90% confidence interval for the rate of progress within each region. This involves randomly sampling (with replacement) the rates of progress from each region and computing the mean rates, which are our test statistics. Repeated sampling will provide an estimate of the bootstrap sampling distributions, which we will visualize as box plots for easy comparison between regions. Lastly, we will calculate the confidence intervals using quantiles, offering a clear range for the rate of progress of each SDG in Asia and Africa.

#Research Question 3: Bootstrappings
```{r}
###Computations
##SDG1
#ASIA

set.seed(100000) #random seed

boot_simulated_values1 <- rep(NA, 2000) #where we will store the means of rate of progress

for (i in 1:2000)
{
  boot_samp1 <- asia_indicator_sdg1_hdr_gnipc %>% sample_n(size=100, replace=TRUE)
  boot_simulated_values1[i] <- as.numeric(boot_samp1 %>% summarize(mean(rate_of_change)))
}

data1 <- data.frame(estimate = boot_simulated_values1) #creating dataset from vector
data1$region = "ASIA" #adding another variable called "region"

#AFRICA
set.seed(100000) #random seed

boot_simulated_values2 <- rep(NA, 2000) #where we will store the means of rate of progress

for (i in 1:2000)
{
  boot_samp2 <- africa_indicator_sdg1_hdr_gnipc %>% sample_n(size=100, replace=TRUE)
  boot_simulated_values2[i] <- as.numeric(boot_samp2 %>% summarize(mean(rate_of_change)))
}

data2 <- data.frame(estimate = boot_simulated_values2) #creating dataset from vector
data2$region = "AFRICA" #adding another variable called "region"

new_data1 <- rbind(data1, data2) #combining two data sets so that we can compare two boxplots in the same figure.

##SDG3
#ASIA
set.seed(100000)

boot_simulated_values3 <- rep(NA, 2000)

for (i in 1:2000)
{
  boot_samp3 <- asia_indicator_sdg3_hdr_life_expectancy %>% sample_n(size=100, replace=TRUE)
  boot_simulated_values3[i] <- as.numeric(boot_samp3 %>% summarize(mean(rate_of_change)))
}

data3 <- data.frame(estimate = boot_simulated_values3)
data3$region = "ASIA"

#AFRICA
set.seed(100000)

boot_simulated_values4 <- rep(NA, 2000)

for (i in 1:2000)
{
  boot_samp4 <- africa_indicator_sdg3_hdr_life_expectancy %>% sample_n(size=100, replace=TRUE)
  boot_simulated_values4[i] <- as.numeric(boot_samp4 %>% summarize(mean(rate_of_change)))
}

data4 <- data.frame(estimate = boot_simulated_values4)
data4$region = "AFRICA"

new_data2 <- rbind(data3, data4)

##SDG4
# ASIA
set.seed(100000)

boot_simulated_values5 <- rep(NA, 2000)

for (i in 1:2000)
{
  boot_samp5 <- asia_indicator_sdg4_hdr_mys %>% sample_n(size=100, replace=TRUE)
  boot_simulated_values5[i] <- as.numeric(boot_samp5 %>% summarize(mean(rate_of_change)))
}

data5 <- data.frame(estimate = boot_simulated_values5)
data5$region = "ASIA"

# AFRICA
set.seed(100000)

boot_simulated_values6 <- rep(NA, 2000)

for (i in 1:2000)
{
  boot_samp6 <- africa_indicator_sdg4_hdr_mys %>% sample_n(size=100, replace=TRUE)
  boot_simulated_values6[i] <- as.numeric(boot_samp6 %>% summarize(mean(rate_of_change)))
}

data6 <- data.frame(estimate = boot_simulated_values6)
data6$region = "AFRICA"

new_data3 <- rbind(data5, data6)

### Visualizations
ggplot(data = new_data1, aes(x=estimate, y=region)) + geom_boxplot(color="black",fill="gray") + labs(x = "means of rate of progress (SDG1)")

ggplot(data = new_data2, aes(x=estimate, y=region)) + geom_boxplot(color="black",fill="gray") + labs(x = "means of rate of progress (SDG3)")

ggplot(data = new_data3, aes(x=estimate, y=region)) + geom_boxplot(color="black",fill="gray") + labs(x = "means of rate of progress (SDG4)")

### Quantiles
quantile(data1$estimate, c(0.05, 0.95))
quantile(data2$estimate, c(0.05, 0.95))
quantile(data3$estimate, c(0.05, 0.95))
quantile(data4$estimate, c(0.05, 0.95))
quantile(data5$estimate, c(0.05, 0.95))
quantile(data6$estimate, c(0.05, 0.95))

```
From the quantiles, 
We are 90% confident that mean rate of progress in SDG1 for all countries in Asia is between 57.13 and 388.55.
We are 90% confident that mean rate of progress in SDG1 for all countries in Africa is between -28.16 and 138.98.
We are 90% confident that mean rate of progress in SDG3 for all countries in Asia is between 0.13 and 0.29.
We are 90 confident that mean rate of progress in SDG3 for all countries in Africa is between 0.43 and 0.56.
We are 90% confident that mean rate of progress in SDG4 for all countries in Asia is between 0.086 and 0.14.
We are 90% confident that mean rate of progress in SDG4 for all countries in Africa is between 0.086 and 0.11.

If we compare these confidence intervals between Asia and Africa for each SDG, we can conclude that Asia has higher mean rate of progress in SDG1 and SDG4 while Africa has higher mean rate of progress in SDG3. 


Hypothesis Testings:
We proposed three two-sided, two-sample hypothesis tests. The null hypothesis posits that the rate of progress on each SDG is the same for both regions. In contrast, the alternative hypothesis suggests differences between Asia and Africa. To test these hypotheses, we simulated the differences in mean rates of progress without replacement, forming distributions visualized via histograms. The determination to accept or reject the null hypothesis will be based on p-values computed at an alpha level of 0.1.


#Research Question 3: Hypothesis Testings
```{r}
##SDG1

#H0: there is no difference in means of rate of progress of SDG1 between Asia and Africa
#H1: there is difference between Asia and Africa

#data cleaning
asia_indicator_sdg1_hdr_gnipc$region = "ASIA"
africa_indicator_sdg1_hdr_gnipc$region = "AFRICA"
ht_data1 <- rbind(asia_indicator_sdg1_hdr_gnipc, africa_indicator_sdg1_hdr_gnipc)

#test statistics (observed)
delta_mean_ts1 <-
    ht_data1 %>% group_by(region) %>% 
    summarize(means = mean(rate_of_change), .groups="drop") %>%
    summarize(value = diff(means)) %>%
    as.numeric()

#simulation
set.seed(10000)

delta_simulations1 <- rep(NA, 2000) #where we will store the simulated values
for(i in 1:2000)
{
  #perform random permutation
  simdata1 <- ht_data1 %>% mutate(group=sample(region), replace=FALSE)
  #compute the simulated test statistic
  delta_mean_sim1 <-
    simdata1 %>% group_by(group) %>% 
    summarize(means = mean(rate_of_change), .groups="drop") %>%
    summarize(value = diff(means)) %>%
    as.numeric()
  #store the simulated value
  delta_simulations1[i] <- delta_mean_sim1
}

q3_ht_sdg1_simulated_values <- tibble(mean_diff = delta_simulations1)

#Visualizations
ggplot(data = q3_ht_sdg1_simulated_values, aes(x = mean_diff)) + geom_histogram(bins=30, color="black", fill="gray") +
  labs(x = "differences", title= "differences in SDG1 rate of progress between Asia and Africa from Random Permutations")

#p-value calculation
p_value_sdg1 <- 
  sum(abs(delta_simulations1 - 0) >= abs(delta_mean_ts1 - 0)) / 2000

print(p_value_sdg1)

##SDG3

#H0: there is no difference in means of rate of progress of SDG3 between Asia and Africa
#H1: there is difference between Asia and Africa

#data cleaning
asia_indicator_sdg3_hdr_life_expectancy$region = "ASIA"
africa_indicator_sdg3_hdr_life_expectancy$region = "AFRICA"
ht_data2 <- rbind(asia_indicator_sdg3_hdr_life_expectancy, africa_indicator_sdg3_hdr_life_expectancy)

#test statistics (observed)
delta_mean_ts2 <-
    ht_data2 %>% group_by(region) %>% 
    summarize(means = mean(rate_of_change), .groups="drop") %>%
    summarize(value = diff(means)) %>%
    as.numeric()

#simulation
set.seed(10000)

delta_simulations2 <- rep(NA, 2000)
for(i in 1:2000)
{
  #perform random permutation
  simdata2 <- ht_data2 %>% select(region, rate_of_change) %>% mutate(group=sample(region), replace=FALSE)
  #compute the simulated test statistic
  delta_mean_sim2 <-
    simdata2 %>% group_by(group) %>% 
    summarize(means = mean(rate_of_change), .groups="drop") %>%
    summarize(value = diff(means)) %>%
    as.numeric()
  #store the simulated value
  delta_simulations2[i] <- delta_mean_sim2
}

q3_ht_sdg3_simulated_values <- tibble(mean_diff = delta_simulations2)

#Visualizations
ggplot(data = q3_ht_sdg3_simulated_values, aes(x = mean_diff)) + geom_histogram(bins=30, color="black", fill="gray") +
  labs(x = "differences", title= "differences in SDG3 rate of progress between Asia and Africa from Random Permutations")

#p-value calculation
p_value_sdg3 <- 
  sum(abs(delta_simulations2 - 0) >= abs(delta_mean_ts2 - 0)) / 2000

print(p_value_sdg3)

##SDG4

#H0: there is no difference in means of rate of progress of SDG4 between Asia and Africa
#H1: there is difference between Asia and Africa

#data cleaning
asia_indicator_sdg4_hdr_mys$region = "ASIA"
africa_indicator_sdg4_hdr_mys$region = "AFRICA"
ht_data3 <- rbind(asia_indicator_sdg4_hdr_mys, africa_indicator_sdg4_hdr_mys)

#test statistics (observed)
delta_mean_ts3 <-
    ht_data3 %>% group_by(region) %>% 
    summarize(means = mean(rate_of_change), .groups="drop") %>%
    summarize(value = diff(means)) %>%
    as.numeric()

#simulation
set.seed(10000)

delta_simulations3 <- rep(NA, 2000)
for(i in 1:2000)
{
  #perform random permutation
  simdata3 <- ht_data3 %>% select(region, rate_of_change) %>% mutate(group=sample(region), replace=FALSE)
  #compute the simulated test statistic
  delta_mean_sim3 <-
    simdata3 %>% group_by(group) %>% 
    summarize(means = mean(rate_of_change), .groups="drop") %>%
    summarize(value = diff(means)) %>%
    as.numeric()
  #store the simulated value
  delta_simulations3[i] <- delta_mean_sim3
}

q3_ht_sdg4_simulated_values <- tibble(mean_diff = delta_simulations3)

#Visualizations
ggplot(data = q3_ht_sdg4_simulated_values, aes(x = mean_diff)) + geom_histogram(bins=30, color="black", fill="gray") +
  labs(x = "differences", title= "differences in SDG4 rate of progress between Asia and Africa from Random Permutations")

#p-value calculation
p_value_sdg4 <- 
  sum(abs(delta_simulations3 - 0) >= abs(delta_mean_ts3 - 0)) / 2000

print(p_value_sdg4)

```

Based on the p-values, we can reject the null for SDG3 because p_value_sdg3 = 5e-4 which is musch less than a-level of 0.1. Meaning, we conclude that there is difference in rate of progress in SDG3 between Asia and Africa. On the other hand, we cannot conclude anything for SDG1 and SDG4 because each p-values are higher than a-level of 0.1 (p_value_sdg1 = 0.3105, p_value_sdg4 = 0.5425).

#Conclusion for Research Question 3
Summary:
SDG1:
  Bootstrappings: Asia has higher rate of progress
  Hypothesis Test: not enough information/ Type II error
SDG3:
  Boostrappings: Africa has higher rate of progress
  Hypothesis Test: there is difference in rate of progress between two regions
SDG4:
  Bootstrappings: Asia has higher rate of progress
  Hypothesis Test: not enough information/ Type II error
  
As above, Hypothesis Tests for SDG1 and 4 have Type II error, meaning, we fail to reject null but based on bootstrappings, null is false. We can think of a cause for this result: if we look at the confidence intervals in bootstrappings, compared to SDG3 result which has distinct difference between Asia and Africa, intervals for Asia and Africa in SDG1 and SDG4 are overlapping. So, we are going to mainly follow results from bootstrappings. 
  
Conclusion:
Asia has higher mean rate of progress in SDG1 and SDG4 whereas Africa has higher mean rate of progress in SDG3. In summary, we predict that Asia will progress more toward SDGs in the future. 





